<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Matrix - Harvest</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Harvest</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">What is Harvest?</a>
                            </li>
                            <li class="navitem">
                                <a href="../../quickstart/" class="nav-link">Quickstart</a>
                            </li>
                            <li class="navitem">
                                <a href="../../install/" class="nav-link">Installation</a>
                            </li>
                            <li class="navitem">
                                <a href="../../system-requirements/" class="nav-link">System Requirements</a>
                            </li>
                            <li class="navitem">
                                <a href="../../upgrade/" class="nav-link">Upgrade</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Prepare Monitored Clusters <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../prepare-cdot-clusters/" class="dropdown-item">ONTAP cDOT</a>
</li>
                                    
<li>
    <a href="../../prepare-7mode-clusters/" class="dropdown-item">ONTAP 7mode</a>
</li>
                                    
<li>
    <a href="../../prepare-storagegrid-clusters/" class="dropdown-item">StorageGRID</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../configure-harvest-basic/" class="nav-link">Configure Harvest (basic)</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Configure Exporters <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../prometheus-exporter/" class="dropdown-item">Prometheus</a>
</li>
                                    
<li>
    <a href="../../influxdb-exporter/" class="dropdown-item">InfluxDB</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../configure-grafana/" class="nav-link">Configure Grafana</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Configure Collectors <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../configure-zapi/" class="dropdown-item">ZAPI</a>
</li>
                                    
<li>
    <a href="../../configure-rest/" class="dropdown-item">REST</a>
</li>
                                    
<li>
    <a href="../../configure-ems/" class="dropdown-item">EMS</a>
</li>
                                    
<li>
    <a href="../../configure-storagegrid/" class="dropdown-item">StorageGRID</a>
</li>
                                    
<li>
    <a href="../../configure-unix/" class="dropdown-item">Unix</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../configure-templates/" class="nav-link">Templates</a>
                            </li>
                            <li class="navitem">
                                <a href="../../dashboards/" class="nav-link">Dashboards</a>
                            </li>
                            <li class="navitem">
                                <a href="../../manage-harvest/" class="nav-link">Manage Harvest Pollers</a>
                            </li>
                            <li class="navitem">
                                <a href="../../configure-harvest-advanced/" class="nav-link">Configure Harvest (advanced)</a>
                            </li>
                            <li class="navitem">
                                <a href="../../troubleshooting/" class="nav-link">Troubleshoot</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../templates-and-metrics/" class="dropdown-item">Templates And Metrics</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Matrix</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../license/" class="dropdown-item">License</a>
</li>
                                    
<li>
    <a href="../../release-notes/" class="dropdown-item">Release Notes</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../templates-and-metrics/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../license/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/NetApp/harvest" class="nav-link">NetApp/harvest</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#matrix" class="nav-link">Matrix</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#basic-usage" class="nav-link">Basic Usage</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#initialize" class="nav-link">Initialize</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#add-instances-and-instance-labels" class="nav-link">Add instances and instance labels</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#add-metrics" class="nav-link">Add Metrics</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#write-numeric-data" class="nav-link">Write numeric data</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#read-metrics-and-instances" class="nav-link">Read metrics and instances</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="matrix">Matrix<a class="headerlink" href="#matrix" title="Permanent link">&para;</a></h2>
<p>The ℳatriχ package provides the <code>matrix.Matrix</code> data-structure for storage, manipulation and transmission of both numeric and non-numeric (string) data. It is utilized by core components of Harvest, including collectors, plugins and exporters. It furthermore serves as an interface between these components, such that "the left hand does not know what the right hand does".</p>
<p>Internally, the Matrix is a collection of metrics (<code>matrix.Metric</code>) and instances (<code>matrix.Instance</code>) in the form of a 2-dimensional array:</p>
<p><img alt="matrix image" src="../../assets/matrix.png" /></p>
<p>Since we use hash tables for accessing the elements of the array, all metrics and instances added to the matrix must have a unique key. Metrics are typed and contain the numeric data (i.e. rows) of the Matrix. Instances only serve as pointers to the columents of the Matrix, but they also store non-numeric data as labels (<code>*dict.Dict</code>).</p>
<p>This package is the architectural backbone of Harvest, therefore understanding it is key for an advanced user or contributor.</p>
<h1 id="basic-usage">Basic Usage<a class="headerlink" href="#basic-usage" title="Permanent link">&para;</a></h1>
<h2 id="initialize">Initialize<a class="headerlink" href="#initialize" title="Permanent link">&para;</a></h2>
<p><div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">matrix</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">identifier</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">Matrix</span><span class="w"></span>
<span class="c1">// always returns successfully pointer to (empty) Matrix </span><span class="w"></span>
</code></pre></div>
This section describes how to properly initialize a new Matrix instance. Note that if you write a collector, a Matrix instance is already properly initialized for you (as <code>MyCollector.matrix</code>), and if you write a plugin or exporter, it is passed to you from the collector. That means most of the time you don't have to worry about initializing the Matrix.</p>
<p><code>matrix.New()</code> requires three arguments:
* <code>UUID</code> is by convention the collector name (e.g. <code>MyCollector</code>) if the Matrix comes from a collector, or the collector name and the plugin name concatenated with a <code>.</code> (e.g. <code>MyCollector.MyPlugin</code>) if the Matrix comes from a plugin.
* <code>object</code> is a description of the instances of the Matrix. For example, if we collect data about cars and our instances are cars, a good name would be <code>car</code>.
* <code>identifier</code> is a unique key used to identify a matrix instance</p>
<p>Note that <code>identifier</code> should uniquely identify a Matrix instance. This is not a strict requirement, but guarantees that your data is properly handled by exporters.</p>
<h3 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h3>
<p>Here is an example from the point of view of a collector:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="s">&quot;github.com/netapp/harvest/v2/pkg/matrix&quot;</span><span class="w"></span>

<span class="kd">var</span><span class="w"> </span><span class="nx">myMatrix</span><span class="w"> </span><span class="o">*</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">Matrix</span><span class="w"></span>

<span class="nx">myMatrix</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">matrix</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;CarCollector&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;car&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;car&quot;</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>Next step is to add metrics and instances to our Matrix.</p>
<h2 id="add-instances-and-instance-labels">Add instances and instance labels<a class="headerlink" href="#add-instances-and-instance-labels" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="nx">Matrix</span><span class="p">)</span><span class="w"> </span><span class="nx">NewInstance</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">Instance</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"></span>
<span class="c1">// returns pointer to a new Instance, or nil with error (if key is not unique)</span><span class="w"></span>
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="nx">Instance</span><span class="p">)</span><span class="w"> </span><span class="nx">SetLabel</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"></span>
<span class="c1">// always successful, overwrites existing values</span><span class="w"></span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="nx">Instance</span><span class="p">)</span><span class="w"> </span><span class="nx">GetLabel</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"></span>
<span class="c1">// always returns value, if label is not set, returns empty string</span><span class="w"></span>
</code></pre></div></p>
<p>Once we have initialized a Matrix, we can add instances and add labels to our instances.</p>
<h3 id="example_1">Example<a class="headerlink" href="#example_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="nx">instance</span><span class="w"> </span><span class="o">*</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">Instance</span><span class="w"></span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">myMatrix</span><span class="p">.</span><span class="nx">NewInstance</span><span class="p">(</span><span class="s">&quot;SomeCarMark&quot;</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span><span class="w"></span>
<span class="w">    </span><span class="c1">// or handle err, but beware that instance is nil</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="nx">instance</span><span class="p">.</span><span class="nx">SetLabel</span><span class="p">(</span><span class="s">&quot;mark&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SomeCarMark&quot;</span><span class="p">)</span><span class="w"></span>
<span class="nx">instance</span><span class="p">.</span><span class="nx">SetLabel</span><span class="p">(</span><span class="s">&quot;color&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">)</span><span class="w"></span>
<span class="nx">instance</span><span class="p">.</span><span class="nx">SetLabel</span><span class="p">(</span><span class="s">&quot;style&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;coupe&quot;</span><span class="p">)</span><span class="w"></span>
<span class="c1">// add as many labels as you like</span><span class="w"></span>
<span class="nx">instance</span><span class="p">.</span><span class="nx">GetLabel</span><span class="p">(</span><span class="s">&quot;color&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// return &quot;red&quot;</span><span class="w"></span>
<span class="nx">instance</span><span class="p">.</span><span class="nx">GetLabel</span><span class="p">(</span><span class="s">&quot;owner&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// returns &quot;&quot;</span><span class="w"></span>
</code></pre></div>
<h2 id="add-metrics">Add Metrics<a class="headerlink" href="#add-metrics" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="nx">Matrix</span><span class="p">)</span><span class="w"> </span><span class="nx">NewMetricInt64</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">Metric</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"></span>
<span class="c1">// returns pointer to a new MetricInt64, or nil with error (if key is not unique)</span><span class="w"></span>
<span class="c1">// note that Metric is an interface</span><span class="w"></span>
</code></pre></div>
<p>Metrics are typed and there are currently 8 types, all can be created with the same signature as above:
* <code>MetricUint8</code>
* <code>MetricUint32</code>
* <code>MetricUint64</code>
* <code>MetricInt</code>
* <code>MetricInt32</code>
* <code>MetricInt64</code>
* <code>MetricFloat32</code>
* <code>MetricFloat64</code>
*
We are able to read from and write to a metric instance using different types (as displayed in the next section), however choosing a type wisely ensures that this is done efficiently and overflow does not occur.</p>
<p>We can add labels to metrics just like instances. This is usually done when we deal with histograms:</p>
<p><div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="nx">Metric</span><span class="p">)</span><span class="w"> </span><span class="nx">SetLabel</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"></span>
<span class="c1">// always successful, overwrites existing values</span><span class="w"></span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="nx">Metric</span><span class="p">)</span><span class="w"> </span><span class="nx">GetLabel</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"></span>
<span class="c1">// always returns value, if label is not set, returns empty string</span><span class="w"></span>
</code></pre></div></p>
<h3 id="example_2">Example<a class="headerlink" href="#example_2" title="Permanent link">&para;</a></h3>
<p>Continuing our Matrix for collecting car-related data:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="nx">speed</span><span class="p">,</span><span class="w"> </span><span class="nx">length</span><span class="w"> </span><span class="nx">matrix</span><span class="p">.</span><span class="nx">Metric</span><span class="w"></span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="nx">speed</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">myMatrix</span><span class="p">.</span><span class="nx">NewMetricUint32</span><span class="p">(</span><span class="s">&quot;max_speed&quot;</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="nx">length</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">myMatrix</span><span class="p">.</span><span class="nx">NewMetricFloat32</span><span class="p">(</span><span class="s">&quot;length_in_mm&quot;</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<h2 id="write-numeric-data">Write numeric data<a class="headerlink" href="#write-numeric-data" title="Permanent link">&para;</a></h2>
<p><div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="nx">Matrix</span><span class="p">)</span><span class="w"> </span><span class="nx">Reset</span><span class="p">()</span><span class="w"></span>
<span class="c1">// flush numeric data from previous poll</span><span class="w"></span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="nx">Metric</span><span class="p">)</span><span class="w"> </span><span class="nx">SetValueInt64</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="nx">Instance</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="kt">int64</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"></span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="nx">Metric</span><span class="p">)</span><span class="w"> </span><span class="nx">SetValueUint8</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="nx">Instance</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="kt">uint8</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"></span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="nx">Metric</span><span class="p">)</span><span class="w"> </span><span class="nx">SetValueUint64</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="nx">Instance</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="kt">uint64</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"></span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="nx">Metric</span><span class="p">)</span><span class="w"> </span><span class="nx">SetValueFloat64</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="nx">Instance</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="kt">float64</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"></span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="nx">Metric</span><span class="p">)</span><span class="w"> </span><span class="nx">SetValueBytes</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="nx">Instance</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"></span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="nx">Metric</span><span class="p">)</span><span class="w"> </span><span class="nx">SetValueString</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="nx">Instance</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"></span>
<span class="c1">// sets the numeric value for the instance i to v</span><span class="w"></span>
<span class="c1">// returns error if v is invalid (explained below)</span><span class="w"></span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="nx">Metric</span><span class="p">)</span><span class="w"> </span><span class="nx">AddValueInt64</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="nx">Instance</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="kt">int64</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"></span>
<span class="c1">// increments the numeric value for the instance i by v</span><span class="w"></span>
<span class="c1">// same signatures for all the types defined above</span><span class="w"></span>
</code></pre></div></p>
<p>When possible you should reuse a Matrix for each data poll, but to do that, you need to call <code>Reset()</code> to drop old data from the Matrix. It is safe to add new instances and metrics after calling this method.</p>
<p>The <code>SetValue*()</code> and <code>AddValue*()</code> methods are typed same as the metrics. Even though you are not required to use the same type as the metric, it is the safest and most efficient way.</p>
<p>Since most collectors get their data as bytes or strings, it is recommended to use the <code>SetValueString()</code> and <code>SetValueBytes()</code> methods.</p>
<p>These methods return an error if value <code>v</code> can not be converted to the type of the metric. Error is always <code>nil</code> when the type of <code>v</code> matches the type of the metric.</p>
<h3 id="example_3">Example<a class="headerlink" href="#example_3" title="Permanent link">&para;</a></h3>
<p>Continuing with the previous examples:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">myMatrix</span><span class="p">.</span><span class="nx">Reset</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="c1">// write numbers to the matrix using the instance and the metrics we have created</span><span class="w"></span>

<span class="c1">// let the metric do the conversion for us</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">speed</span><span class="p">.</span><span class="nx">SetValueString</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;500&quot;</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">Prefix</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;set speed value: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="c1">// here we ignore err since type is the metric type</span><span class="w"></span>
<span class="nx">length</span><span class="p">.</span><span class="nx">SetValueFloat64</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="mf">10000.00</span><span class="p">)</span><span class="w"></span>

<span class="c1">// safe to add new instances</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">instance2</span><span class="w"> </span><span class="nx">matrix</span><span class="p">.</span><span class="nx">Instance</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="nx">instance2</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">myMatrix</span><span class="p">.</span><span class="nx">NewInstance</span><span class="p">(</span><span class="s">&quot;SomeOtherCar&quot;</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// possible and safe even though speed has type Float32</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">length</span><span class="p">.</span><span class="nx">SetValueInt64</span><span class="p">(</span><span class="nx">instance2</span><span class="p">,</span><span class="w"> </span><span class="mi">13000</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">Prefix</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;set speed value:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// possible, but will overflow since speed is unsigned</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">speed</span><span class="p">.</span><span class="nx">SetValueInt64</span><span class="p">(</span><span class="nx">instance2</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">500</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">Prefix</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;set length value:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<h2 id="read-metrics-and-instances">Read metrics and instances<a class="headerlink" href="#read-metrics-and-instances" title="Permanent link">&para;</a></h2>
<p>In this section we switch gears and look at the Matrix from the point of view of plugins and exporters. Both those components need to read from the Matrix and have no knowledge of its origin or contents.</p>
<p><div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="nx">Matrix</span><span class="p">)</span><span class="w"> </span><span class="nx">GetMetrics</span><span class="p">()</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">Metric</span><span class="w"></span>
<span class="c1">// returns all metrics in the Matrix</span><span class="w"></span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="nx">Matrix</span><span class="p">)</span><span class="w"> </span><span class="nx">GetInstances</span><span class="p">()</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">Instance</span><span class="w"></span>
<span class="c1">// returns all instances in the Matrix</span><span class="w"></span>
</code></pre></div></p>
<p>Usually we will do a nested loop with these two methods to read all data in the Matrix. See examples below.</p>
<h3 id="example-iterate-over-instances">Example: Iterate over instances<a class="headerlink" href="#example-iterate-over-instances" title="Permanent link">&para;</a></h3>
<p>In this example the method <code>PrintKeys()</code> will iterate over a Matrix and print all metric and instance keys.</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">PrintKeys</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">Matrix</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">instanceKey</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">x</span><span class="p">.</span><span class="nx">GetInstances</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;instance key=&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">instanceKey</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<h3 id="example-read-instance-labels">Example: Read instance labels<a class="headerlink" href="#example-read-instance-labels" title="Permanent link">&para;</a></h3>
<p>Each instance has a set of labels. We can iterate over these labels with the <code>GetLabel()</code> and <code>GetLabels()</code> method. In this example, we write a function that prints all labels of an instance:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">PrintLabels</span><span class="p">(</span><span class="nx">instance</span><span class="w"> </span><span class="o">*</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">Instance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">label</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">instance</span><span class="p">.</span><span class="nx">GetLabels</span><span class="p">().</span><span class="nx">Map</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s=%s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">label</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<h3 id="example-read-metric-values-labels">Example: Read metric values labels<a class="headerlink" href="#example-read-metric-values-labels" title="Permanent link">&para;</a></h3>
<p>Similar to the <code>SetValue*</code> and <code>AddValue*</code> methods, you can choose a type when reading from a metric. If you don't know the type of the metric, it is safe to read it as a string. In this example, we write a function that prints the value of a metric for all instances in a Matrix:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">PrintMetricValues</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">Matrix</span><span class="p">,</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="nx">matrix</span><span class="p">.</span><span class="nx">Metric</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">instance</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">x</span><span class="p">.</span><span class="nx">GetInstances</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">has</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">GetValueString</span><span class="p">(</span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;instance %s = %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;instance %s has no value\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; NetApp</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
