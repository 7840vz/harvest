<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Templates And Metrics - Harvest</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Harvest</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">What is Harvest?</a>
                            </li>
                            <li class="navitem">
                                <a href="../../quickstart/" class="nav-link">Quickstart</a>
                            </li>
                            <li class="navitem">
                                <a href="../../install/" class="nav-link">Installation</a>
                            </li>
                            <li class="navitem">
                                <a href="../../system-requirements/" class="nav-link">System Requirements</a>
                            </li>
                            <li class="navitem">
                                <a href="../../upgrade/" class="nav-link">Upgrade</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Prepare Monitored Clusters <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../prepare-cdot-clusters/" class="dropdown-item">ONTAP cDOT</a>
</li>
                                    
<li>
    <a href="../../prepare-7mode-clusters/" class="dropdown-item">ONTAP 7mode</a>
</li>
                                    
<li>
    <a href="../../prepare-storagegrid-clusters/" class="dropdown-item">StorageGRID</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../configure-harvest-basic/" class="nav-link">Configure Harvest (basic)</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Configure Exporters <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../prometheus-exporter/" class="dropdown-item">Prometheus</a>
</li>
                                    
<li>
    <a href="../../influxdb-exporter/" class="dropdown-item">InfluxDB</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../configure-grafana/" class="nav-link">Configure Grafana</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Configure Collectors <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../configure-zapi/" class="dropdown-item">ZAPI</a>
</li>
                                    
<li>
    <a href="../../configure-rest/" class="dropdown-item">REST</a>
</li>
                                    
<li>
    <a href="../../configure-ems/" class="dropdown-item">EMS</a>
</li>
                                    
<li>
    <a href="../../configure-storagegrid/" class="dropdown-item">StorageGRID</a>
</li>
                                    
<li>
    <a href="../../configure-unix/" class="dropdown-item">Unix</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../configure-templates/" class="nav-link">Templates</a>
                            </li>
                            <li class="navitem">
                                <a href="../../dashboards/" class="nav-link">Dashboards</a>
                            </li>
                            <li class="navitem">
                                <a href="../../manage-harvest/" class="nav-link">Manage Harvest Pollers</a>
                            </li>
                            <li class="navitem">
                                <a href="../../configure-harvest-advanced/" class="nav-link">Configure Harvest (advanced)</a>
                            </li>
                            <li class="navitem">
                                <a href="../../troubleshooting/" class="nav-link">Troubleshoot</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="./" class="dropdown-item active">Templates And Metrics</a>
</li>
                                    
<li>
    <a href="../matrix/" class="dropdown-item">Matrix</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../license/" class="dropdown-item">License</a>
</li>
                                    
<li>
    <a href="../../release-notes/" class="dropdown-item">Release Notes</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../../troubleshooting/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../matrix/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/NetApp/harvest" class="nav-link">NetApp/harvest</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#harvest-templates-and-metrics" class="nav-link">Harvest Templates and Metrics</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#handy-tools" class="nav-link">Handy Tools</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#ontap-zapi-disk-example" class="nav-link">ONTAP ZAPI disk example</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#harvest-templates" class="nav-link">Harvest Templates</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#common-errors-and-troubleshooting" class="nav-link">Common Errors and Troubleshooting</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#prometheus-wire-format" class="nav-link">Prometheus Wire Format</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="harvest-templates-and-metrics">Harvest Templates and Metrics<a class="headerlink" href="#harvest-templates-and-metrics" title="Permanent link">&para;</a></h1>
<p>Harvest collects ONTAP counter information, augments it, and stores it in a time-series DB.</p>
<pre class="mermaid"><code>flowchart RL
    Harvest[Harvest&lt;br&gt;Get &amp; Augment] -- REST&lt;br&gt;ZAPI --&gt; ONTAP
    id1[(Prometheus&lt;br&gt;Store)] -- Scrape --&gt; Harvest</code></pre>
<p>Three concepts work in unison to collect ONTAP metrics data,
prepare it and make it available to Prometheus.</p>
<ul>
<li>ZAPI/REST</li>
<li>Harvest templates</li>
<li>Exporters </li>
</ul>
<p>We're going to walk through an example from a running system, focusing on the <code>disk</code> object.</p>
<p>At a high-level, Harvest templates describe what ZAPIs to send to ONTAP and how to interpret the responses.</p>
<ul>
<li>ONTAP defines twos ZAPIs to collect <code>disk</code> info<ul>
<li>Config information is collected via <code>storage-disk-get-iter</code></li>
<li>Performance counters are collected via <code>disk:constituent</code></li>
</ul>
</li>
<li>These ZAPIs are found in their corresponding object template file <code>conf/zapi/cdot/9.8.0/disk.yaml</code>
  and <code>conf/zapiperf/cdot/9.8.0/disk.yaml</code>. These files also describe how to map the ZAPI responses into a
  time-series-friendly format</li>
<li>Prometheus uniquely identifies a time series by its metric name and optional key-value pairs called labels.</li>
</ul>
<h2 id="handy-tools">Handy Tools<a class="headerlink" href="#handy-tools" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://github.com/TomWright/dasel">dasel</a> is useful to convert between XML, YAML, JSON, etc. We'll use it to make
  displaying some of the data easier.</li>
</ul>
<h2 id="ontap-zapi-disk-example">ONTAP ZAPI disk example<a class="headerlink" href="#ontap-zapi-disk-example" title="Permanent link">&para;</a></h2>
<p>We'll use the <code>bin/zapi</code> tool to interrogate the cluster and gather information about the counters. This is one way you
can send ZAPIs to ONTAP and explore the return types and values.</p>
<div class="highlight"><pre><span></span><code>bin/zapi -p u2 show attrs --api storage-disk-get-iter
</code></pre></div>
<blockquote>
<p>Output edited for brevity and line numbers added on left</p>
</blockquote>
<p>The hierarchy and return type of each counter is shown below. We'll use this hierarchy to build a matching Harvest
template.
For example, line <code>3</code> is the <code>bytes-per-sector</code> counter, which has an integer value, and is the child
of <code>storage-disk-info &gt; disk-inventory-info</code>.</p>
<p>To capture that counter's value as a metric in a Harvest, the ZAPI template must use the same hierarchical path. The
matching path can be seen <a href="#harvest-object-template">below</a>.</p>
<div class="highlight"><pre><span></span><code>building tree for attribute [attributes-list] =&gt; [storage-disk-info]

 1 [storage-disk-info]            -               *
 2   [disk-inventory-info]        -                
 3     [bytes-per-sector]         -         integer
 4     [capacity-sectors]         -         integer
 5     [disk-type]                -          string
 6     [is-shared]                -         boolean
 7     [model]                    -          string
 8     [serial-number]            -          string
 9     [shelf]                    -          string
10     [shelf-bay]                -          string
11   [disk-name]                  -          string
12   [disk-ownership-info]        -                
13     [home-node-name]           -          string
14     [is-failed]                -         boolean
15     [owner-node-name]          -          string
16   [disk-raid-info]             -                
17     [container-type]           -          string
18     [disk-outage-info]         -                
19       [is-in-fdr]              -         boolean
20       [reason]                 -          string  
21   [disk-stats-info]            -                
22     [average-latency]          -         integer
23     [disk-io-kbps]             -         integer
24     [power-on-time-interval]   -         integer
25     [sectors-read]             -         integer
26     [sectors-written]          -         integer
27   [disk-uid]                   -          string
28   [node-name]                  -          string
29   [storage-disk-state]         -         integer
30   [storage-disk-state-flags]   -         integer
</code></pre></div>
<h2 id="harvest-templates">Harvest Templates<a class="headerlink" href="#harvest-templates" title="Permanent link">&para;</a></h2>
<p>To understand templates, there are a few concepts to cover:</p>
<p>There are three kinds of information included in templates that define what Harvest collects and exports:</p>
<ol>
<li>Configuration information is exported into the <code>_labels</code> metric (e.g. <code>disk_labels</code> see below)</li>
<li>Metrics data is exported as <code>disk_"metric name"</code> e.g. <code>disk_bytes_per_sector</code>, <code>disk_sectors</code>, etc. Metrics are leaf
   nodes that are not prefixed with a ^ or ^^. Metrics must be one of the number types: float or int.</li>
<li>Plugins may add additional metrics, increasing the number of metrics exported in #2</li>
</ol>
<p>A resource will typically have multiple instances. Using disk as an example, that means there will be one <code>disk_labels</code>
and a metric row per instance. If we have 24 disks and the disk template lists seven metrics to capture, Harvest will
export a total of 192 rows of Prometheus data.</p>
<p><code>24 instances * (7 metrics per instance + 1 label per instance) = 192 rows</code></p>
<p>Sum of disk metrics that Harvest exports</p>
<div class="highlight"><pre><span></span><code>curl -s &#39;http://localhost:14002/metrics&#39; | grep ^disk | cut -d&#39;{&#39; -f1 | sort | uniq -c
  24 disk_bytes_per_sector
  24 disk_labels
  24 disk_sectors
  24 disk_stats_average_latency
  24 disk_stats_io_kbps
  24 disk_stats_sectors_read
  24 disk_stats_sectors_written
  24 disk_uptime
# 192 rows 
</code></pre></div>
<p>Read on to see how we control which labels from #1 and which metrics from #2 are included in the exported data.</p>
<h3 id="instance-keys-and-labels">Instance Keys and Labels<a class="headerlink" href="#instance-keys-and-labels" title="Permanent link">&para;</a></h3>
<ul>
<li>Instance key - An instance key defines the set of attributes Harvest uses to construct a key that uniquely identifies
  an object. For example, the disk template uses the <code>node</code> + <code>disk</code> attributes to determine uniqueness. Using <code>node</code>
  or <code>disk</code> alone wouldn't be sufficient since disks on separate nodes can have the same name. If a single label does
  not uniquely identify an instance, combine multiple keys for uniqueness. Instance keys must refer to attributes that
  are of type <code>string</code>.</li>
</ul>
<p>Because instance keys define uniqueness, these keys are also added to each metric as a key-value pair. (
  see <a href="#control-what-labels-and-metrics-are-exported">Control What Labels and Metrics are Exported</a> for examples)</p>
<ul>
<li>Instance label - Labels are key-value pairs used to gather configuration information about each instance. All of the
  key-value pairs are combined into a single metric named <code>disk_labels</code>. There will be one <code>disk_labels</code> for each
  monitored instance. Here's an example reformatted so it's easier to read:</li>
</ul>
<div class="highlight"><pre><span></span><code>disk_labels{
  datacenter=&quot;dc-1&quot;,
  cluster=&quot;umeng-aff300-05-06&quot;,
  node=&quot;umeng-aff300-06&quot;,
  disk=&quot;1.1.23&quot;,
  type=&quot;SSD&quot;,
  model=&quot;X371_S1643960ATE&quot;,
  outage=&quot;&quot;,
  owner_node=&quot;umeng-aff300-06&quot;,
  shared=&quot;true&quot;,
  shelf=&quot;1&quot;,
  shelf_bay=&quot;23&quot;,
  serial_number=&quot;S3SENE0K500532&quot;,
  failed=&quot;false&quot;,
  container_type=&quot;shared&quot;
}
</code></pre></div>
<h3 id="harvest-object-template">Harvest Object Template<a class="headerlink" href="#harvest-object-template" title="Permanent link">&para;</a></h3>
<p>Continuing with the disk example, below is the <code>conf/zapi/cdot/9.8.0/disk.yaml</code> that tells Harvest which ZAPI to send to
ONTAP (<code>storage-disk-get-iter</code>) and describes how to interpret and export the response.</p>
<ul>
<li>Line <code>1</code> defines the name of this resource and is an exact match to the object defined in your <code>default.yaml</code>
  or <code>custom.yaml</code> file. Eg.</li>
</ul>
<div class="highlight"><pre><span></span><code># default.yaml
objects:
  Disk:  disk.yaml
</code></pre></div>
<ul>
<li>Line <code>2</code> is the name of the ZAPI that Harvest will send to collect disk resources</li>
<li>Line <code>3</code> is the prefix used to export metrics associated with this object. i.e. all metrics will be of the
  form <code>disk_*</code></li>
<li>Line <code>5</code> the <a href="https://github.com/NetApp/harvest/tree/main/conf#counters">counter section</a> is where we define the
  metrics, labels, and what constitutes instance uniqueness</li>
<li>Line <code>7</code> the double hat prefix <code>^^</code> means this attribute is an instance key used to determine uniqueness. Instance
  keys are also included as labels. Uuids are good choices for uniqueness</li>
<li>Line <code>13</code> the single hat prefix <code>^</code> means this attribute should be stored as a label. That means we can include it in
  the <code>export_options</code> section as one of the key-value pairs in <code>disk_labels</code></li>
<li>Rows 10, 11, 23, 24, 25, 26, 27 - these are the metrics rows - metrics are leaf nodes that are not prefixed with a ^
  or ^^. If you refer back to the <a href="#ontap-zapi-disk-example">ONTAP ZAPI disk example</a> above, you'll notice each of these
  attributes are integer types.</li>
<li>Line 43 defines the set of labels to use when constructing the <code>disk_labels</code> metrics. As
  mentioned <a href="#instance-keys-and-labels">above</a>, these labels capture config-related attributes per instance.</li>
</ul>
<blockquote>
<p>Output edited for brevity and line numbers added for reference.</p>
</blockquote>
<div class="highlight"><pre><span></span><code> 1  name:             Disk
 2  query:            storage-disk-get-iter
 3  object:           disk
 4  
 5  counters:
 6    storage-disk-info:
 7      - ^^disk-uid
 8      - ^^disk-name               =&gt; disk
 9      - disk-inventory-info:
10        - bytes-per-sector        =&gt; bytes_per_sector        # notice this has the same hierarchical path we saw from bin/zapi
11        - capacity-sectors        =&gt; sectors
12        - ^disk-type              =&gt; type
13        - ^is-shared              =&gt; shared
14        - ^model                  =&gt; model
15        - ^serial-number          =&gt; serial_number
16        - ^shelf                  =&gt; shelf
17        - ^shelf-bay              =&gt; shelf_bay
18      - disk-ownership-info:
19        - ^home-node-name         =&gt; node
20        - ^owner-node-name        =&gt; owner_node
21        - ^is-failed              =&gt; failed
22      - disk-stats-info:
23        - average-latency
24        - disk-io-kbps
25        - power-on-time-interval  =&gt; uptime
26        - sectors-read
27        - sectors-written
28      - disk-raid-info:
29        - ^container-type         =&gt; container_type
30        - disk-outage-info:
31          - ^reason               =&gt; outage
32  
33  plugins:
34    - LabelAgent:
35      # metric label zapi_value rest_value `default_value`
36      value_to_num:
37        - new_status outage - - `0` #ok_value is empty value, &#39;-&#39; would be converted to blank while processing.
38  
39  export_options:
40    instance_keys:
41      - node
42      - disk
43    instance_labels:
44      - type
45      - model
46      - outage
47      - owner_node
48      - shared
49      - shelf
50      - shelf_bay
51      - serial_number
52      - failed
53      - container_type
</code></pre></div>
<h3 id="control-what-labels-and-metrics-are-exported">Control What Labels and Metrics are Exported<a class="headerlink" href="#control-what-labels-and-metrics-are-exported" title="Permanent link">&para;</a></h3>
<p>Let's continue with <code>disk</code> and look at a few examples. We'll use <code>curl</code> to examine the Prometheus wire format that
Harvest uses to export the metrics from <code>conf/zapi/cdot/9.8.0/disk.yaml</code>.</p>
<p>The curl below shows all exported disk metrics. There are 24 disks on this cluster, Harvest is collecting seven
metrics + one disk_labels + one plugin-created metric, <code>disk_new_status</code> for a total of 216 rows.</p>
<div class="highlight"><pre><span></span><code>curl -s &#39;http://localhost:14002/metrics&#39; | grep ^disk | cut -d&#39;{&#39; -f1 | sort | uniq -c
  24 disk_bytes_per_sector           # metric
  24 disk_labels                     # labels 
  24 disk_new_status                 # plugin created metric 
  24 disk_sectors                    # metric 
  24 disk_stats_average_latency      # metric   
  24 disk_stats_io_kbps              # metric 
  24 disk_stats_sectors_read         # metric   
  24 disk_stats_sectors_written      # metric  
  24 disk_uptime                     # metric
# sum = ((7 + 1 + 1) * 24 = 216 rows)
</code></pre></div>
<p>Here's a <code>disk_labels</code> for one instance, reformated to make it easier to read.</p>
<div class="highlight"><pre><span></span><code>curl -s &#39;http://localhost:14002/metrics&#39; | grep ^disk_labels | head -1

disk_labels{
  datacenter = &quot;dc-1&quot;,                 # always included - value taken from datacenter in harvest.yml
  cluster = &quot;umeng-aff300-05-06&quot;,      # always included
  node = &quot;umeng-aff300-06&quot;,            # node is in the list of export_options instance_keys
  disk = &quot;1.1.13&quot;,                     # disk is in the list of export_options instance_keys
  type = &quot;SSD&quot;,                        # remainder are included because they are listed in the template&#39;s instance_labels
  model = &quot;X371_S1643960ATE&quot;,
  outage = &quot;&quot;,
  owner_node = &quot;umeng-aff300-06&quot;,
  shared = &quot;true&quot;,
  shelf = &quot;1&quot;,
  shelf_bay = &quot;13&quot;,
  serial_number = &quot;S3SENE0K500572&quot;,
  failed = &quot;false&quot;,
  container_type = &quot;&quot;,
} 1.0
</code></pre></div>
<p>Here's the <code>disk_sectors</code> metric for a single instance.</p>
<div class="highlight"><pre><span></span><code>curl -s &#39;http://localhost:14002/metrics&#39; | grep ^disk_sectors | head -1

disk_sectors{                          # prefix of disk_ + metric name (line 11 in template)
  datacenter = &quot;dc-1&quot;,                 # always included - value taken from datacenter in harvest.yml
  cluster = &quot;umeng-aff300-05-06&quot;,      # always included
  node = &quot;umeng-aff300-06&quot;,            # node is in the list of export_options instance_keys
  disk = &quot;1.1.17&quot;,                     # disk is in the list of export_options instance_keys
} 1875385008                           # metric value - number of sectors for this disk instance
</code></pre></div>
<div class="highlight"><pre><span></span><code>Number of rows for each template = number of instances * (number of metrics + 1 (for &lt;name&gt;_labels row) + plugin additions)
Number of metrics                = number of counters which are not labels or keys, those without a ^ or ^^
</code></pre></div>
<h2 id="common-errors-and-troubleshooting">Common Errors and Troubleshooting<a class="headerlink" href="#common-errors-and-troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="1-failed-to-parse-any-metrics">1. Failed to parse any metrics<a class="headerlink" href="#1-failed-to-parse-any-metrics" title="Permanent link">&para;</a></h3>
<p>You add a new template to Harvest, restart your poller, and get an error message:</p>
<div class="highlight"><pre><span></span><code>WRN ./poller.go:649 &gt; init collector-object (Zapi:NetPort): no metrics =&gt; failed to parse any
</code></pre></div>
<p>This means the collector, <code>Zapi NetPort</code>, was unable to find any metrics. <a href="#harvest-templates">Recall metrics</a> are lines
without prefixes. In cases where you don't have any metrics, but still want to collect labels, add
the <code>collect_only_labels: true</code> key-value to your template. This flag tells Harvest to ignore that you don't have
metrics and
continue. <a href="https://github.com/NetApp/harvest/blob/7334f11419075bf98b45fd14aee41dc2c16e4531/conf/zapi/cdot/9.8.0/qtree.yaml#L17">Example</a>.</p>
<h3 id="2-missing-data">2. Missing Data<a class="headerlink" href="#2-missing-data" title="Permanent link">&para;</a></h3>
<ol>
<li>What happens if an attribute is listed in the list of <code>instance_labels</code> (line 43 above), but that label is missing
   from the list of counters captured at line 5?</li>
</ol>
<p>The label will still be written into <code>disk_labels</code>, but the value will be empty since it's missing. e.g if line 29 was
deleted <code>container_type</code> would still be present in <code>disk_labels{container_type=""}</code>.</p>
<h2 id="prometheus-wire-format">Prometheus Wire Format<a class="headerlink" href="#prometheus-wire-format" title="Permanent link">&para;</a></h2>
<p>https://prometheus.io/docs/instrumenting/exposition_formats/</p>
<p>Keep in mind that Prometheus does not permit dashes (<code>-</code>) in labels. That's why Harvest templates use name replacement
to convert dashed-names to underscored-names with <code>=&gt;</code>. e.g. <code>bytes-per-sector =&gt; bytes_per_sector</code>
converts <code>bytes-per-sector</code> into the Prometheus accepted <code>bytes_per_sector</code>.</p>
<p>Every time series is uniquely identified by its metric name and optional key-value pairs called labels.</p>
<p>Labels enable Prometheus's dimensional data model: any combination of labels for the same metric name identifies a
particular dimensional instantiation of that metric (for example: all HTTP requests that used the method POST to the
/api/tracks handler). The query language allows filtering and aggregation based on these dimensions. Changing any label
value, including adding or removing a label, will create a new time series.</p>
<blockquote>
<p><code>&lt;metric_name&gt;{&lt;label_name&gt;=&lt;label_value&gt;, ...} value [ timestamp ]</code></p>
<ul>
<li>metric_name and label_name carry the usual Prometheus expression language restrictions</li>
<li>label_value can be any sequence of UTF-8 characters, but the backslash (), double-quote ("), and line feed (\n)
    characters have to be escaped as \, \", and \n, respectively.</li>
<li>value is a float represented as required by Go's ParseFloat() function. In addition to standard numerical values,
    NaN, +Inf, and -Inf are valid values representing not a number, positive infinity, and negative infinity,
    respectively.</li>
<li>timestamp is an int64 (milliseconds since epoch, i.e. 1970-01-01 00:00:00 UTC, excluding leap seconds), represented
    as required by Go's ParseInt() function</li>
</ul>
<p><a href="https://prometheus.io/docs/instrumenting/exposition_formats/#comments-help-text-and-type-information">Exposition formats</a> </p>
</blockquote></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; NetApp</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
