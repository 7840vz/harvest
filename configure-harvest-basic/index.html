<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Configure Harvest (basic) - Harvest</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Harvest</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">What is Harvest?</a>
                            </li>
                            <li class="navitem">
                                <a href="../quickstart/" class="nav-link">Quickstart</a>
                            </li>
                            <li class="navitem">
                                <a href="../install/" class="nav-link">Installation</a>
                            </li>
                            <li class="navitem">
                                <a href="../system-requirements/" class="nav-link">System Requirements</a>
                            </li>
                            <li class="navitem">
                                <a href="../upgrade/" class="nav-link">Upgrade</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Prepare Monitored Clusters <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../prepare-cdot-clusters/" class="dropdown-item">ONTAP cDOT</a>
</li>
                                    
<li>
    <a href="../prepare-7mode-clusters/" class="dropdown-item">ONTAP 7mode</a>
</li>
                                    
<li>
    <a href="../prepare-storagegrid-clusters/" class="dropdown-item">StorageGRID</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">Configure Harvest (basic)</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Configure Exporters <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../prometheus-exporter/" class="dropdown-item">Prometheus</a>
</li>
                                    
<li>
    <a href="../influxdb-exporter/" class="dropdown-item">InfluxDB</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../configure-grafana/" class="nav-link">Configure Grafana</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Configure Collectors <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../configure-zapi/" class="dropdown-item">ZAPI</a>
</li>
                                    
<li>
    <a href="../configure-rest/" class="dropdown-item">REST</a>
</li>
                                    
<li>
    <a href="../configure-ems/" class="dropdown-item">EMS</a>
</li>
                                    
<li>
    <a href="../configure-storagegrid/" class="dropdown-item">StorageGRID</a>
</li>
                                    
<li>
    <a href="../configure-unix/" class="dropdown-item">Unix</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../configure-templates/" class="nav-link">Templates</a>
                            </li>
                            <li class="navitem">
                                <a href="../dashboards/" class="nav-link">Dashboards</a>
                            </li>
                            <li class="navitem">
                                <a href="../manage-harvest/" class="nav-link">Manage Harvest Pollers</a>
                            </li>
                            <li class="navitem">
                                <a href="../configure-harvest-advanced/" class="nav-link">Configure Harvest (advanced)</a>
                            </li>
                            <li class="navitem">
                                <a href="../troubleshooting/" class="nav-link">Troubleshoot</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../resources/templates-and-metrics/" class="dropdown-item">Templates And Metrics</a>
</li>
                                    
<li>
    <a href="../resources/matrix/" class="dropdown-item">Matrix</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../license/" class="dropdown-item">License</a>
</li>
                                    
<li>
    <a href="../release-notes/" class="dropdown-item">Release Notes</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../prepare-storagegrid-clusters/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../prometheus-exporter/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/NetApp/harvest" class="nav-link">NetApp/harvest</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#pollers" class="nav-link">Pollers</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#defaults" class="nav-link">Defaults</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#exporters" class="nav-link">Exporters</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#tools" class="nav-link">Tools</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#configuring-collectors" class="nav-link">Configuring collectors</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#labels" class="nav-link">Labels</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#credentials-file" class="nav-link">Credentials File</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>The main configuration file, <code>harvest.yml</code>, consists of the following sections, described below:</p>
<h2 id="pollers">Pollers<a class="headerlink" href="#pollers" title="Permanent link">&para;</a></h2>
<p>All pollers are defined in <code>harvest.yml</code>, the main configuration file of Harvest, under the section <code>Pollers</code>.</p>
<table>
<thead>
<tr>
<th>parameter</th>
<th>type</th>
<th>description</th>
<th>default</th>
</tr>
</thead>
<tbody>
<tr>
<td>Poller name (header)</td>
<td><strong>required</strong></td>
<td>Poller name, user-defined value</td>
<td></td>
</tr>
<tr>
<td><code>datacenter</code></td>
<td><strong>required</strong></td>
<td>Datacenter name, user-defined value</td>
<td></td>
</tr>
<tr>
<td><code>addr</code></td>
<td>required by some collectors</td>
<td>IPv4 or FQDN of the target system</td>
<td></td>
</tr>
<tr>
<td><code>collectors</code></td>
<td><strong>required</strong></td>
<td>List of collectors to run for this poller</td>
<td></td>
</tr>
<tr>
<td><code>exporters</code></td>
<td><strong>required</strong></td>
<td>List of exporter names from the <code>Exporters</code> section. Note: this should be the name of the exporter (e.g. <code>prometheus1</code>), not the value of the <code>exporter</code> key (e.g. <code>Prometheus</code>)</td>
<td></td>
</tr>
<tr>
<td><code>auth_style</code></td>
<td>required by Zapi* collectors</td>
<td>Either <code>basic_auth</code> or <code>certificate_auth</code></td>
<td><code>basic_auth</code></td>
</tr>
<tr>
<td><code>username</code>, <code>password</code></td>
<td>required if <code>auth_style</code> is <code>basic_auth</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>ssl_cert</code>, <code>ssl_key</code></td>
<td>optional if <code>auth_style</code> is <code>certificate_auth</code></td>
<td>Absolute paths to SSL (client) certificate and key used to authenticate with the target system.<br /><br />If not provided, the poller will look for <code>&lt;hostname&gt;.key</code> and <code>&lt;hostname&gt;.pem</code> in <code>$HARVEST_HOME/cert/</code>.<br/><br/>To create certificates for ONTAP systems, see <a href="../prepare-cdot-clusters/#using-certificate-authentication">using certificate authentication</a></td>
<td></td>
</tr>
<tr>
<td><code>use_insecure_tls</code></td>
<td>optional, bool</td>
<td>If true, disable TLS verification when connecting to ONTAP cluster</td>
<td>false</td>
</tr>
<tr>
<td><code>credentials_file</code></td>
<td>optional, string</td>
<td>Path to a yaml file that contains cluster credentials. The file should have the same shape as <code>harvest.yml</code>. See <a href="./#credentials-file">here</a> for examples. Path can be relative to <code>harvest.yml</code> or absolute</td>
<td></td>
</tr>
<tr>
<td><code>tls_min_version</code></td>
<td>optional, string</td>
<td>Minimum TLS version to use when connecting to ONTAP cluster: One of tls10, tls11, tls12 or tls13</td>
<td>Platform decides</td>
</tr>
<tr>
<td><code>labels</code></td>
<td>optional, list of key-value pairs</td>
<td>Each of the key-value pairs will be added to a poller's metrics. Details <a href="./#labels">below</a></td>
<td></td>
</tr>
<tr>
<td><code>log_max_bytes</code></td>
<td></td>
<td>Maximum size of the log file before it will be rotated</td>
<td><code>5_242_880</code> (5 MB)</td>
</tr>
<tr>
<td><code>log_max_files</code></td>
<td></td>
<td>Number of rotated log files to keep</td>
<td><code>5</code></td>
</tr>
<tr>
<td><code>log</code></td>
<td>optional, list of collector names</td>
<td>Matching collectors log their ZAPI request/response</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="defaults">Defaults<a class="headerlink" href="#defaults" title="Permanent link">&para;</a></h2>
<p>This section is optional. If there are parameters identical for all your pollers (e.g. datacenter, authentication
method, login preferences), they can be grouped under this section. The poller section will be checked first and if the
values aren't found there, the defaults will be consulted.</p>
<h2 id="exporters">Exporters<a class="headerlink" href="#exporters" title="Permanent link">&para;</a></h2>
<p>All exporters need two types of parameters:</p>
<ul>
<li><code>exporter parameters</code> - defined in <code>harvest.yml</code> under <code>Exporters</code> section</li>
<li><code>export_options</code> - these options are defined in the <code>Matrix</code> data structure that is emitted from collectors and
  plugins</li>
</ul>
<p>The following two parameters are required for all exporters:</p>
<table>
<thead>
<tr>
<th>parameter</th>
<th>type</th>
<th>description</th>
<th>default</th>
</tr>
</thead>
<tbody>
<tr>
<td>Exporter name (header)</td>
<td><strong>required</strong></td>
<td>Name of the exporter instance, this is a user-defined value</td>
<td></td>
</tr>
<tr>
<td><code>exporter</code></td>
<td><strong>required</strong></td>
<td>Name of the exporter class (e.g. Prometheus, InfluxDB, Http) - these can be found under the <code>cmd/exporters/</code> directory</td>
<td></td>
</tr>
</tbody>
</table>
<p>Note: when we talk about the <em>Prometheus Exporter</em> or <em>InfluxDB Exporter</em>, we mean the Harvest modules that send the
data to a database, NOT the names used to refer to the actual databases.</p>
<h3 id="prometheus-exporter"><a href="../prometheus-exporter/">Prometheus Exporter</a><a class="headerlink" href="#prometheus-exporter" title="Permanent link">&para;</a></h3>
<h3 id="influxdb-exporter"><a href="../influxdb-exporter/">InfluxDB Exporter</a><a class="headerlink" href="#influxdb-exporter" title="Permanent link">&para;</a></h3>
<h2 id="tools">Tools<a class="headerlink" href="#tools" title="Permanent link">&para;</a></h2>
<p>This section is optional. You can uncomment the <code>grafana_api_token</code> key and add your Grafana API token so <code>harvest</code> does
not prompt you for the key when importing dashboards.</p>
<div class="highlight"><pre><span></span><code>Tools:
  #grafana_api_token: &#39;aaa-bbb-ccc-ddd&#39;
</code></pre></div>
<h2 id="configuring-collectors">Configuring collectors<a class="headerlink" href="#configuring-collectors" title="Permanent link">&para;</a></h2>
<p>Collectors are configured by their own configuration files (<a href="../configure-templates/">templates</a>), which are stored in subdirectories
in <a href="https://github.com/NetApp/harvest/tree/main/conf">conf/</a>.
Most collectors run concurrently and collect a subset of related metrics.
For example, node related metrics are grouped together and run independently of the disk related metrics.
Below is a snippet from <code>conf/zapi/default.yaml</code></p>
<p>In this example, the <code>default.yaml</code> template contains a list of objects (e.g. Node) that reference sub-templates (e.g.
node.yaml). This decomposition groups related metrics together and at runtime, a <code>Zapi</code> collector per object will be
created and each of these collectors will run concurrently.</p>
<p>Using the snippet below, we expect there to be four <code>Zapi</code> collectors running, each with a different subtemplate and
object.</p>
<div class="highlight"><pre><span></span><code>collector:          Zapi
objects:
  Node:             node.yaml
  Aggregate:        aggr.yaml
  Volume:           volume.yaml
  SnapMirror:       snapmirror.yaml
</code></pre></div>
<p>At start-up, Harvest looks for two files (<code>default.yaml</code> and <code>custom.yaml</code>) in the <code>conf</code> directory of the
collector (e.g. <code>conf/zapi/default.yaml</code>).
The <code>default.yaml</code> is installed by default, while the <code>custom.yaml</code> is an optional file
you can create
to <a href="../configure-templates/#creatingediting-templates">add new templates</a>.</p>
<p>When present, the <code>custom.yaml</code> file will be merged with the <code>default.yaml</code> file.
This behavior can be overridden in your <code>harvest.yml</code>, see
<a href="https://github.com/NetApp/harvest/blob/main/pkg/conf/testdata/issue_396.yaml">here</a> for an example.</p>
<p>For a list of collector-specific parameters, refer to their individual documentation.</p>
<h4 id="zapi-and-zapiperf"><a href="../configure-zapi/">Zapi and ZapiPerf</a><a class="headerlink" href="#zapi-and-zapiperf" title="Permanent link">&para;</a></h4>
<h4 id="rest-and-restperf"><a href="../configure-rest/">Rest and RestPerf</a><a class="headerlink" href="#rest-and-restperf" title="Permanent link">&para;</a></h4>
<h4 id="ems"><a href="../configure-ems/">EMS</a><a class="headerlink" href="#ems" title="Permanent link">&para;</a></h4>
<h4 id="storagegrid"><a href="../configure-storagegrid/">StorageGRID</a><a class="headerlink" href="#storagegrid" title="Permanent link">&para;</a></h4>
<h4 id="unix"><a href="../configure-unix/">Unix</a><a class="headerlink" href="#unix" title="Permanent link">&para;</a></h4>
<h2 id="labels">Labels<a class="headerlink" href="#labels" title="Permanent link">&para;</a></h2>
<p>Labels offer a way to add additional key-value pairs to a poller's metrics. These allow you to tag a cluster's metrics
in a cross-cutting fashion. Here's an example:</p>
<div class="highlight"><pre><span></span><code>  cluster-03:
    datacenter: DC-01
    addr: 10.0.1.1
    labels:
      - org: meg       # add an org label with the value &quot;meg&quot;
      - ns:  rtp       # add a namespace label with the value &quot;rtp&quot;
</code></pre></div>
<p>These settings add two key-value pairs to each metric collected from <code>cluster-03</code> like this:</p>
<div class="highlight"><pre><span></span><code>node_vol_cifs_write_data{org=&quot;meg&quot;,ns=&quot;rtp&quot;,datacenter=&quot;DC-01&quot;,cluster=&quot;cluster-03&quot;,node=&quot;umeng-aff300-05&quot;} 10
</code></pre></div>
<p>Keep in mind that each unique combination of key-value pairs increases the amount of stored data. Use them sparingly.
See <a href="https://prometheus.io/docs/practices/naming/#labels">PrometheusNaming</a> for details.</p>
<h2 id="credentials-file">Credentials File<a class="headerlink" href="#credentials-file" title="Permanent link">&para;</a></h2>
<p>If you would rather not list cluster credentials in your <code>harvest.yml</code>, you can use the <code>credentials_file</code> section
in your <code>harvest.yml</code> to point to a file that contains the credentials.
At runtime, the <code>credentials_file</code> will be read and the included credentials will be used to authenticate with the
matching cluster(s).</p>
<p>This is handy when integrating with 3rd party credential stores.
See #884 for examples.</p>
<p>The format of the <code>credentials_file</code> is similar to <code>harvest.yml</code> and can contain multiple cluster credentials.</p>
<p>Example:</p>
<p>Snippet from <code>harvest.yml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">Pollers</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">cluster1</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">addr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.193.48.11</span><span class="w"></span>
<span class="w">    </span><span class="nt">credentials_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secrets/cluster1.yml</span><span class="w"></span>
<span class="w">    </span><span class="nt">exporters</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prom1</span><span class="w"> </span>
</code></pre></div>
<p>File <code>secrets/cluster1.yml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">Pollers</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">cluster1</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">harvest</span><span class="w"></span>
<span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span><span class="w"></span>
</code></pre></div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; NetApp</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
