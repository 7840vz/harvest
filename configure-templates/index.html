<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Templates - Harvest</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Harvest</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">What is Harvest?</a>
                            </li>
                            <li class="navitem">
                                <a href="../quickstart/" class="nav-link">Quickstart</a>
                            </li>
                            <li class="navitem">
                                <a href="../install/" class="nav-link">Installation</a>
                            </li>
                            <li class="navitem">
                                <a href="../system-requirements/" class="nav-link">System Requirements</a>
                            </li>
                            <li class="navitem">
                                <a href="../upgrade/" class="nav-link">Upgrade</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Prepare Monitored Clusters <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../prepare-cdot-clusters/" class="dropdown-item">ONTAP cDOT</a>
</li>
                                    
<li>
    <a href="../prepare-7mode-clusters/" class="dropdown-item">ONTAP 7mode</a>
</li>
                                    
<li>
    <a href="../prepare-storagegrid-clusters/" class="dropdown-item">StorageGRID</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../configure-harvest-basic/" class="nav-link">Configure Harvest (basic)</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Configure Exporters <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../prometheus-exporter/" class="dropdown-item">Prometheus</a>
</li>
                                    
<li>
    <a href="../influxdb-exporter/" class="dropdown-item">InfluxDB</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../configure-grafana/" class="nav-link">Configure Grafana</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Configure Collectors <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../configure-zapi/" class="dropdown-item">ZAPI</a>
</li>
                                    
<li>
    <a href="../configure-rest/" class="dropdown-item">REST</a>
</li>
                                    
<li>
    <a href="../configure-ems/" class="dropdown-item">EMS</a>
</li>
                                    
<li>
    <a href="../configure-storagegrid/" class="dropdown-item">StorageGRID</a>
</li>
                                    
<li>
    <a href="../configure-unix/" class="dropdown-item">Unix</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">Templates</a>
                            </li>
                            <li class="navitem">
                                <a href="../dashboards/" class="nav-link">Dashboards</a>
                            </li>
                            <li class="navitem">
                                <a href="../manage-harvest/" class="nav-link">Manage Harvest Pollers</a>
                            </li>
                            <li class="navitem">
                                <a href="../configure-harvest-advanced/" class="nav-link">Configure Harvest (advanced)</a>
                            </li>
                            <li class="navitem">
                                <a href="../troubleshooting/" class="nav-link">Troubleshoot</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../resources/templates-and-metrics/" class="dropdown-item">Templates And Metrics</a>
</li>
                                    
<li>
    <a href="../resources/matrix/" class="dropdown-item">Matrix</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../license/" class="dropdown-item">License</a>
</li>
                                    
<li>
    <a href="../release-notes/" class="dropdown-item">Release Notes</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../configure-unix/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../dashboards/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/NetApp/harvest" class="nav-link">NetApp/harvest</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#creatingediting-templates" class="nav-link">Creating/editing templates</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#collector-templates" class="nav-link">Collector templates</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#object-templates" class="nav-link">Object Templates</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#extend-an-existing-object-template" class="nav-link">Extend an existing object template</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#harvest-versioned-templates" class="nav-link">Harvest Versioned Templates</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="creatingediting-templates">Creating/editing templates<a class="headerlink" href="#creatingediting-templates" title="Permanent link">&para;</a></h2>
<p>This document covers how to use <a href="./#collector-templates">Collector</a>
and <a href="./#object-templates">Object</a> templates to extend Harvest.</p>
<ol>
<li><a href="./#create-a-new-object-template">How to add a new object template</a></li>
<li><a href="./#extend-an-existing-object-template">How to extend an existing object template</a></li>
</ol>
<p>There are a couple of ways to learn about ZAPIs and their attributes:</p>
<ul>
<li><a href="https://mysupport.netapp.com/documentation/productlibrary/index.html?productID=60427">ONTAP's documentation</a></li>
<li>Using Harvest's <code>zapi</code> tool to explore available APIs and metrics on your cluster. Examples:</li>
</ul>
<div class="highlight"><pre><span></span><code>$ harvest zapi --poller &lt;poller&gt; show apis
  <span class="c1"># will print list of apis that are available</span>
  <span class="c1"># usually apis with the &quot;get-iter&quot; suffix can provide useful metrics</span>
$ harvest zapi --poller &lt;poller&gt; show attrs --api volume-get-iter
  <span class="c1"># will print the attribute tree of the API</span>
$ harvest zapi --poller &lt;poller&gt; show data --api volume-get-iter
  <span class="c1"># will print raw data of the API attribute tree</span>
</code></pre></div>
<p>(Replace <code>&lt;poller&gt;</code> with the name of a poller that can connect to an ONTAP system.)</p>
<h2 id="collector-templates">Collector templates<a class="headerlink" href="#collector-templates" title="Permanent link">&para;</a></h2>
<p>Collector templates define which set of objects Harvest should collect from the system being monitored.
In your <code>harvest.yml</code> configuration file, when you say that you want to use a <code>Zapi</code> collector, that
collector will read the matching <code>conf/zapi/default.yaml</code> - same with <code>ZapiPerf</code>, it will read
the <code>conf/zapiperf/default.yaml</code> file. Belows's a snippet from <code>conf/zapi/default.yaml</code>. Each object is mapped to a
corresponding <a href="./#object-templates">object template</a> file. For example, the <code>Node</code> object searches
for the <a href="./#harvest-versioned-templates">most appropriate version</a> of the <code>node.yaml</code> file in
the <code>conf/zapi/cdot/**</code> directory.</p>
<div class="highlight"><pre><span></span><code>collector:          Zapi
objects:
  Node:             node.yaml
  Aggregate:        aggr.yaml
  Volume:           volume.yaml
  Disk:             disk.yaml
</code></pre></div>
<p>Each collector will also check if a matching file named, <code>custom.yaml</code> exists, and if it does, it will read that file
and merge it with <code>default.yaml</code>. The <code>custom.yaml</code> file should be located beside the matching <code>default.yaml</code> file. (
eg. <code>conf/zapi/custom.yaml</code> is beside <code>conf/zapi/default.yaml</code>).</p>
<p>Let's take a look at some examples.</p>
<ol>
<li>Define a poller that uses the default Zapi collector. Using the default template is the easiest and most used option.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nt">Pollers</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">jamaica</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">datacenter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">munich</span><span class="w"></span>
<span class="w">    </span><span class="nt">addr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.10.10.10</span><span class="w"></span>
<span class="w">    </span><span class="nt">collectors</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Zapi</span><span class="w"> </span><span class="c1"># will use conf/zapi/default.yaml and optionally merge with conf/zapi/custom.yaml</span><span class="w"></span>
</code></pre></div>
<ol>
<li>Define a poller that uses the Zapi collector, but with a custom template file:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nt">Pollers</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">jamaica</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">datacenter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">munich</span><span class="w"></span>
<span class="w">    </span><span class="nt">addr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.10.10.10</span><span class="w"></span>
<span class="w">    </span><span class="nt">collectors</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ZapiPerf</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">limited.yaml</span><span class="w"> </span><span class="c1"># will use conf/zapiperf/limited.yaml</span><span class="w"></span>
<span class="w">        </span><span class="c1"># more templates can be added, they will be merged</span><span class="w"></span>
</code></pre></div>
<h2 id="object-templates">Object Templates<a class="headerlink" href="#object-templates" title="Permanent link">&para;</a></h2>
<p>Object templates (example: <code>conf/zapi/cdot/9.8.0/lun.yaml</code>) describe what to collect and export. These templates are
used by collectors to gather metrics and send them to your time-series db.</p>
<p>Object templates are made up of the following parts:</p>
<ol>
<li>the name of the object (or resource) to collect</li>
<li>the ZAPI or REST query used to collect the object</li>
<li>a list of object counters to collect and how to export them</li>
</ol>
<p>Instead of editing one of the existing templates, it's better to extend one of them. That way, your custom template will
not be overwritten when upgrading Harvest. For example, if you want to extend <code>conf/zapi/cdot/9.8.0/aggr.yaml</code>, first
create a copy (e.g., <code>conf/zapi/cdot/9.8.0/custom_aggr.yaml</code>), and then tell Harvest to use your custom template by
adding these lines to <code>conf/zapi/custom.yaml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">objects</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">Aggregate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom_aggr.yaml</span><span class="w"></span>
</code></pre></div>
<p>After restarting your pollers, <code>aggr.yaml</code> and <code>custom_aggr.yaml</code> will be merged.</p>
<h3 id="create-a-new-object-template">Create a new object template<a class="headerlink" href="#create-a-new-object-template" title="Permanent link">&para;</a></h3>
<p>In this example, imagine that Harvest doesn't already collect environment sensor data and you wanted to collect it.
Sensor does comes from the <code>environment-sensors-get-iter</code> ZAPI. Here are the steps to add a new object template.</p>
<p>Create the file <code>conf/zapi/cdot/9.8.0/sensor.yaml</code> (optionally replace <code>9.8.0</code> with the earliest version of ONTAP that
supports sensor data. Refer to <a href="./#harvest-versioned-templates">Harvest Versioned Templates</a> for
more information. Add the following content to your new <code>sensor.yaml</code> file.</p>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Sensor</span><span class="w">                      </span><span class="c1"># this name must match the key in your custom.yaml file</span><span class="w"></span>
<span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">environment-sensors-get-iter</span><span class="w"></span>
<span class="nt">object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sensor</span><span class="w"></span>

<span class="nt">metric_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int64</span><span class="w"></span>

<span class="nt">counters</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">environment-sensors-info</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical-high-threshold    =&gt; critical_high</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical-low-threshold     =&gt; critical_low</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^discrete-sensor-state     =&gt; discrete_state</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^discrete-sensor-value     =&gt; discrete_value</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^^node-name                =&gt; node</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^^sensor-name              =&gt; sensor</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^sensor-type               =&gt; type</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^threshold-sensor-state    =&gt; threshold_state</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">threshold-sensor-value     =&gt; threshold_value</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^value-units               =&gt; unit</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^warning-high-threshold    =&gt; warning_high</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^warning-low-threshold     =&gt; warning_low</span><span class="w"></span>

<span class="nt">export_options</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">include_all_labels</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
</code></pre></div>
<h3 id="enable-the-new-object-template">Enable the new object template<a class="headerlink" href="#enable-the-new-object-template" title="Permanent link">&para;</a></h3>
<p>To enable the new sensor object template, create the <code>conf/zapi/custom.yaml</code> file with the lines shown below.</p>
<div class="highlight"><pre><span></span><code><span class="nt">objects</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">Sensor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sensor.yaml</span><span class="w">                 </span><span class="c1"># this key must match the name in your sensor.yaml file</span><span class="w"></span>
</code></pre></div>
<p>The <code>Sensor</code> key used in the <code>custom.yaml</code> must match the name defined in the <code>sensor.yaml</code> file. That mapping is what
connects this object with its template. In the future, if you add more object templates, you can add those in your
existing <code>custom.yaml</code> file.</p>
<h3 id="test-your-object-template-changes">Test your object template changes<a class="headerlink" href="#test-your-object-template-changes" title="Permanent link">&para;</a></h3>
<p>Test your new <code>Sensor</code> template with a single poller like this:</p>
<div class="highlight"><pre><span></span><code>./bin/harvest start &lt;poller&gt; --foreground --verbose --collectors Zapi --objects Sensor
</code></pre></div>
<p>Replace <code>&lt;poller&gt;</code> with the name of one of your ONTAP pollers.</p>
<p>Once you have confirmed that the new template works, restart any already running pollers that you want to use the new
template(s).</p>
<h3 id="check-the-metrics">Check the metrics<a class="headerlink" href="#check-the-metrics" title="Permanent link">&para;</a></h3>
<p>If you are using the Prometheus exporter, you can scrape the poller's HTTP endpoint with curl or a web browser. E.g., my
poller exports its data on port 15001. Adjust as needed for your exporter.</p>
<div class="highlight"><pre><span></span><code>curl -s &#39;http://localhost:15001/metrics&#39; | grep ^sensor_  # sensor_ name matches the object: value in your sensor.yaml file.

sensor_value{datacenter=&quot;WDRF&quot;,cluster=&quot;shopfloor&quot;,critical_high=&quot;3664&quot;,node=&quot;shopfloor-02&quot;,sensor=&quot;P3.3V STBY&quot;,type=&quot;voltage&quot;,warning_low=&quot;3040&quot;,critical_low=&quot;2960&quot;,threshold_state=&quot;normal&quot;,unit=&quot;mV&quot;,warning_high=&quot;3568&quot;} 3280
sensor_value{datacenter=&quot;WDRF&quot;,cluster=&quot;shopfloor&quot;,sensor=&quot;P1.2V STBY&quot;,type=&quot;voltage&quot;,threshold_state=&quot;normal&quot;,warning_high=&quot;1299&quot;,warning_low=&quot;1105&quot;,critical_low=&quot;1086&quot;,node=&quot;shopfloor-02&quot;,critical_high=&quot;1319&quot;,unit=&quot;mV&quot;} 1193
sensor_value{datacenter=&quot;WDRF&quot;,cluster=&quot;shopfloor&quot;,unit=&quot;mV&quot;,critical_high=&quot;15810&quot;,critical_low=&quot;0&quot;,node=&quot;shopfloor-02&quot;,sensor=&quot;P12V STBY&quot;,type=&quot;voltage&quot;,threshold_state=&quot;normal&quot;} 11842
sensor_value{datacenter=&quot;WDRF&quot;,cluster=&quot;shopfloor&quot;,sensor=&quot;P12V STBY Curr&quot;,type=&quot;current&quot;,threshold_state=&quot;normal&quot;,unit=&quot;mA&quot;,critical_high=&quot;3182&quot;,critical_low=&quot;0&quot;,node=&quot;shopfloor-02&quot;} 748
sensor_value{datacenter=&quot;WDRF&quot;,cluster=&quot;shopfloor&quot;,critical_low=&quot;1470&quot;,node=&quot;shopfloor-02&quot;,sensor=&quot;Sysfan2 F2 Speed&quot;,type=&quot;fan&quot;,threshold_state=&quot;normal&quot;,unit=&quot;RPM&quot;,warning_low=&quot;1560&quot;} 2820
sensor_value{datacenter=&quot;WDRF&quot;,cluster=&quot;shopfloor&quot;,sensor=&quot;PSU2 Fan1 Speed&quot;,type=&quot;fan&quot;,threshold_state=&quot;normal&quot;,unit=&quot;RPM&quot;,warning_low=&quot;4600&quot;,critical_low=&quot;4500&quot;,node=&quot;shopfloor-01&quot;} 6900
sensor_value{datacenter=&quot;WDRF&quot;,cluster=&quot;shopfloor&quot;,sensor=&quot;PSU1 InPwr Monitor&quot;,type=&quot;unknown&quot;,threshold_state=&quot;normal&quot;,unit=&quot;mW&quot;,node=&quot;shopfloor-01&quot;} 132000
sensor_value{datacenter=&quot;WDRF&quot;,cluster=&quot;shopfloor&quot;,critical_high=&quot;58&quot;,type=&quot;thermal&quot;,unit=&quot;C&quot;,warning_high=&quot;53&quot;,critical_low=&quot;0&quot;,node=&quot;shopfloor-01&quot;,sensor=&quot;Bat Temp&quot;,threshold_state=&quot;normal&quot;,warning_low=&quot;5&quot;} 24
sensor_value{datacenter=&quot;WDRF&quot;,cluster=&quot;shopfloor&quot;,critical_high=&quot;9000&quot;,node=&quot;shopfloor-01&quot;,sensor=&quot;Bat Charge Volt&quot;,type=&quot;voltage&quot;,threshold_state=&quot;normal&quot;,unit=&quot;mV&quot;,warning_high=&quot;8900&quot;} 8200
sensor_value{datacenter=&quot;WDRF&quot;,cluster=&quot;shopfloor&quot;,node=&quot;shopfloor-02&quot;,sensor=&quot;PSU1 InPwr Monitor&quot;,type=&quot;unknown&quot;,threshold_state=&quot;normal&quot;,unit=&quot;mW&quot;} 132000
</code></pre></div>
<h2 id="extend-an-existing-object-template">Extend an existing object template<a class="headerlink" href="#extend-an-existing-object-template" title="Permanent link">&para;</a></h2>
<h3 id="how-to-extend-a-restrestperfems-collectors-existing-object-template">How to extend a Rest/RestPerf/Ems collector's existing object template<a class="headerlink" href="#how-to-extend-a-restrestperfems-collectors-existing-object-template" title="Permanent link">&para;</a></h3>
<p>Instead of editing one of the existing templates, it's better to copy one and edit the copy. That way, your custom
template will not be overwritten when upgrading Harvest. For example, if you want to
change <code>conf/rest/cdot/9.12.0/aggr.yaml</code>, first create a copy (e.g., <code>conf/rest/cdot/9.12.0/custom_aggr.yaml</code>), then add
these lines to <code>conf/rest/custom.yaml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">objects</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">Aggregate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom_aggr.yaml</span><span class="w"></span>
</code></pre></div>
<p>After restarting pollers, <code>aggr.yaml</code> will be ignored and the new, <code>custom_aggr.yaml</code> subtemplate will be used instead.</p>
<h3 id="how-to-extend-a-zapizapiperf-collectors-existing-object-template">How to extend a Zapi/ZapiPerf collector's existing object template<a class="headerlink" href="#how-to-extend-a-zapizapiperf-collectors-existing-object-template" title="Permanent link">&para;</a></h3>
<p>In this example, we want to extend one of the existing object templates that Harvest ships with,
e.g. <code>conf/zapi/cdot/9.8.0/lun.yaml</code> and collect additional information as outlined below.</p>
<p>Let's say you want to extend <code>lun.yaml</code> to:</p>
<ol>
<li>Increase <code>client_timeout</code> (You want to increase the default timeout of the lun ZAPI because it
   keeps <a href="https://github.com/NetApp/harvest/wiki/Troubleshooting-Harvest#client_timeout">timing out</a>)</li>
<li>Add additional counters, e.g. <code>multiprotocol-type</code>, <code>application</code></li>
<li>Add a new counter to the already collected lun metrics using the <code>value_to_num</code> plugin</li>
<li>Add a new <code>application</code> instance_keys and labels to the collected metrics</li>
</ol>
<p>Let's assume the existing template is located at conf/zapi/cdot/9.8.0/lun.yaml and contains the following.</p>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Lun</span><span class="w"></span>
<span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lun-get-iter</span><span class="w"></span>
<span class="nt">object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lun</span><span class="w"></span>

<span class="nt">counters</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">lun-info</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^node</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^path</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^qtree</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">size</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">size-used</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^state</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^^uuid</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^volume</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^vserver =&gt; svm</span><span class="w"></span>

<span class="nt">plugins</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">LabelAgent</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># metric label zapi_value rest_value `default_value`</span><span class="w"></span>
<span class="w">    </span><span class="nt">value_to_num</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">new_status state online online `0`</span><span class="w"></span>
<span class="w">    </span><span class="nt">split</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path `/` ,,,lun</span><span class="w"></span>

<span class="nt">export_options</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">instance_keys</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qtree</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lun</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">volume</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svm</span><span class="w"></span>
<span class="w">  </span><span class="nt">instance_labels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">state</span><span class="w"></span>
<span class="w w-Error"> </span><span class="err">```</span><span class="w"></span>

<span class="l l-Scalar l-Scalar-Plain">To extend the out-of-the-box `lun.yaml` template, create a `conf/zapi/custom.yaml` file if it doesn&#39;t already exist and</span><span class="w"></span>
<span class="nt">add the lines shown below</span><span class="p">:</span><span class="w"></span>

<span class="err">```</span><span class="l l-Scalar l-Scalar-Plain">yaml</span><span class="w"></span>
<span class="nt">objects</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">Lun</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom_lun.yaml</span><span class="w"></span>
</code></pre></div>
<p>Create a new object template <code>conf/zapi/cdot/9.8.0/custom_lun.yaml</code> with the lines shown below.</p>
<div class="highlight"><pre><span></span><code><span class="nt">client_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span><span class="w"></span>
<span class="nt">counters</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">lun-info</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^multiprotocol-type</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^application</span><span class="w"></span>

<span class="nt">plugins</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">LabelAgent</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">value_to_num</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom_status state online online `0`</span><span class="w"></span>

<span class="nt">export_options</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">instance_keys</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">application</span><span class="w"></span>
<span class="w w-Error"> </span><span class="err">```</span><span class="w"></span>

<span class="l l-Scalar l-Scalar-Plain">When you restart your pollers, Harvest will take the out-of-the-box template (`lun.yaml`) and your new</span><span class="w"></span>
<span class="nt">one (`custom_lun.yaml`) and merge them into the following</span><span class="p">:</span><span class="w"></span>

<span class="err">```</span><span class="l l-Scalar l-Scalar-Plain">yaml</span><span class="w"></span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Lun</span><span class="w"></span>
<span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lun-get-iter</span><span class="w"></span>
<span class="nt">object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lun</span><span class="w"></span>
<span class="nt">counters</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">lun-info</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^node</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^path</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^qtree</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">size</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">size-used</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^state</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^^uuid</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^volume</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^vserver =&gt; svm</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^multiprotocol-type</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^application</span><span class="w"></span>
<span class="nt">plugins</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">LabelAgent</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">value_to_num</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">new_status state online online `0`</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom_status state online online `0`</span><span class="w"></span>
<span class="w">    </span><span class="nt">split</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path `/` ,,,lun</span><span class="w"></span>
<span class="nt">export_options</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">instance_keys</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qtree</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lun</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">volume</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svm</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">application</span><span class="w"></span>
<span class="nt">client_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span><span class="w"></span>
</code></pre></div>
<p>To help understand the merging process and the resulting combined template, you can view the result with:</p>
<div class="highlight"><pre><span></span><code>bin/harvest doctor merge --template conf/zapi/cdot/9.8.0/lun.yaml --with conf/zapi/cdot/9.8.0/custom_lun.yaml
</code></pre></div>
<h3 id="replace-an-existing-object-template-for-zapizapiperf-collector">Replace an existing object template for Zapi/ZapiPerf Collector<a class="headerlink" href="#replace-an-existing-object-template-for-zapizapiperf-collector" title="Permanent link">&para;</a></h3>
<p>You can only extend existing templates for Zapi/ZapiPerf Collector as
explained <a href="./#extend-an-existing-object-template">above</a>.
If you need to replace one of the existing object templates, let us know
on <a href="https://github.com/NetApp/harvest/blob/main/SUPPORT.md#getting-help">Discord</a> or GitHub.</p>
<h2 id="harvest-versioned-templates">Harvest Versioned Templates<a class="headerlink" href="#harvest-versioned-templates" title="Permanent link">&para;</a></h2>
<p>Harvest ships with a set of versioned templates tailored for specific versions of ONTAP. At runtime, Harvest uses a
BestFit heuristic to pick the most appropriate template. The BestFit heuristic compares the list of Harvest templates
with the ONTAP version and selects the best match. There are versioned templates for both the ZAPI and REST collectors.
Below is an example of how the BestFit algorithm works - assume Harvest has these templated versions:</p>
<ul>
<li>9.6.0</li>
<li>9.6.1</li>
<li>9.8.0</li>
<li>9.9.0</li>
<li>9.10.1</li>
</ul>
<p>if you are monitoring a cluster at these versions, Harvest will select the indicated template:</p>
<ul>
<li>ONTAP version 9.4.1, Harvest will select the templates for 9.6.0</li>
<li>ONTAP version 9.6.0, Harvest will select the templates for 9.6.0</li>
<li>ONTAP version 9.7.X, Harvest will select the templates for 9.6.1</li>
<li>ONTAP version 9.12, Harvest will select the templates for 9.10.1</li>
</ul>
<h3 id="counters">counters<a class="headerlink" href="#counters" title="Permanent link">&para;</a></h3>
<p>This section contains the complete or partial attribute tree of the queried API. Since the collector does not get
counter metadata from the ONTAP system, two additional symbols are used for non-numeric attributes:</p>
<ul>
<li><code>^</code> used as a prefix indicates that the attribute should be stored as a label</li>
<li><code>^^</code> indicates that the attribute is a label and an instance key (i.e., a label that uniquely identifies an instance,
  such as <code>name</code>, <code>uuid</code>). If a single label does not uniquely identify an instance, then multiple instance keys should
  be indicated.</li>
</ul>
<p>Additionally, the symbol <code>=&gt;</code> can be used to set a custom display name for both instance labels and numeric counters.
Example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Spare</span><span class="w"></span>
<span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aggr-spare-get-iter</span><span class="w"></span>
<span class="nt">object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spare</span><span class="w"></span>
<span class="nt">collect_only_labels</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="nt">counters</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">aggr-spare-disk-info</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^^disk</span><span class="w">                                </span><span class="c1"># creates label aggr-disk</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^disk-type</span><span class="w">                            </span><span class="c1"># creates label aggr-disk-type</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^is-disk-zeroed   =&gt; is_disk_zeroed</span><span class="w">   </span><span class="c1"># creates label is_disk_zeroed</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^^original-owner  =&gt; original_owner</span><span class="w">   </span><span class="c1"># creates label original_owner</span><span class="w"></span>
<span class="nt">export_options</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">instance_keys</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">disk</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">original_owner</span><span class="w"></span>
<span class="w">  </span><span class="nt">instance_labels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">disk_type</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">is_disk_zeroed</span><span class="w"></span>
</code></pre></div>
<p>Harvest does its best to determine a unique display name for each template's label and metric. Instead of relying on
this heuristic, it is better to be explicit in your templates and define a display name using the caret (<code>^</code>) mapping.
For example, instead of this:</p>
<div class="highlight"><pre><span></span><code>aggr-spare-disk-info:
    - ^^disk
    - ^disk-type
</code></pre></div>
<p>do this:</p>
<div class="highlight"><pre><span></span><code>aggr-spare-disk-info:
    - ^^disk      =&gt; disk
    - ^disk-type  =&gt; disk_type
</code></pre></div>
<p>See also <a href="https://github.com/NetApp/harvest/issues/585">#585</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; NetApp</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
